// === PRODUCT DATA WITH REAL IMAGES AND IDs ===
const products = {
    allproducts: [
        // Combine all products from categories
        {
            id: 'tshirt-1',
            name: "Infinite",
            price: 250,
            img: "acidic 3.jpg",
            description: "Classic Infinite design t-shirt"
        },
        {
            id: 'tshirt-2',
            name: "Infinite II",
            price: 350,
            img: "acidic 33.jpg",
            description: "Second edition Infinite t-shirt"
        },
        {
            id: 'tshirt-3',
            name: "Acidic Effect",
            price: 350,
            img: "acidic 4.jpg",
            description: "Vibrant Acidic Effect design"
        },
        {
            id: 'tshirt-4',
            name: "Lightning",
            price: 300,
            img: "acidic 19.jpg",
            description: "Striking lightning bolt design"
        },
        {
            id: 'tshirt-5',
            name: "Naruto",
            price: 400,
            img: "acidic 14.jpg",
            description: "Anime-inspired Naruto design"
        },
        {
            id: 'tshirt-6',
            name: "Hand Signature",
            price: 300,
            img: "acidic 16.jpg",
            description: "Artistic hand signature design"
        },
        {
            id: 'tshirt-7',
            name: "Hand Signature II",
            price: 300,
            img: "acidic 15.jpg",
            description: "Second edition hand signature"
        },
        {
            id: 'tshirt-8',
            name: "Feather Rainbow",
            price: 300,
            img: "acidic 26.jpg",
            description: "Colorful feather rainbow design"
        },
        {
            id: 'tshirt-9',
            name: "Angelic",
            price: 300,
            img: "acidic 1.jpg",
            description: "Ethereal angelic design"
        },
        {
            id: 'tshirt-10',
            name: "Rainbow",
            price: 350,
            img: "acidic 6.jpg",
            description: "Vibrant rainbow pattern"
        },
        {
            id: 'tshirt-11',
            name: "Butterfly Effect",
            price: 300,
            img: "acidic 9.jpg",
            description: "Beautiful butterfly design"
        },
        {
            id: 'sweater-1',
            name: "Infinite",
            price: 350,
            img: "acidic 2.jpg",
            description: "Warm Infinite design sweater"
        },
        {
            id: 'sweater-2',
            name: "Infinite II",
            price: 400,
            img: "acidic 7.jpg",
            description: "Second edition Infinite sweater"
        },
        {
            id: 'sweater-3',
            name: "Acidic Effect",
            price: 450,
            img: "acidic m.jpg",
            description: "Bold Acidic Effect sweater"
        },
        {
            id: 'sweater-4',
            name: "Angelic",
            price: 400,
            img: "acidic 1.jpg",
            description: "Heavenly angelic design sweater"
        },
        {
            id: 'sweater-5',
            name: "Rainbow",
            price: 400,
            img: "acidic 34.jpg",
            description: "Colorful rainbow sweater"
        },
        {
            id: 'sweater-6',
            name: "Butterfly Effect",
            price: 400,
            img: "acidic.jpg",
            description: "Elegant butterfly design sweater"
        },
        {
            id: 'hoodie-1',
            name: "Infinite II",
            price: 500,
            img: "acidic 8.jpg",
            description: "Comfortable Infinite II hoodie"
        },
        {
            id: 'hoodie-2',
            name: "Feather Rainbow",
            price: 450,
            img: "acidic 5.jpg",
            description: "Colorful feather rainbow hoodie"
        },
        {
            id: 'hoodie-3',
            name: "Hand Signature",
            price: 450,
            img: "acidic 24.jpg",
            description: "Artistic hand signature hoodie"
        },
        {
            id: 'hoodie-4',
            name: "Hand Signature II",
            price: 450,
            img: "acidic 23.jpg",
            description: "Second edition signature hoodie"
        },
        {
            id: 'hoodie-5',
            name: "Naruto",
            price: 550,
            img: "acidic 22.jpg",
            description: "Anime-inspired Naruto hoodie"
        },
        {
            id: 'hoodie-6',
            name: "Angelic",
            price: 450,
            img: "acidic 25.jpg",
            description: "Ethereal angelic design hoodie"
        },
        {
            id: 'hoodie-7',
            name: "Rainbow",
            price: 450,
            img: "acidic 27.jpg",
            description: "Vibrant rainbow hoodie"
        },
        {
            id: 'hoodie-8',
            name: "Lightning",
            price: 450,
            img: "acidic 21.jpg",
            description: "Striking lightning design hoodie"
        },
        {
            id: 'hoodie-9',
            name: "Infinite",
            price: 400,
            img: "acidic 32.jpg",
            description: "Classic Infinite design hoodie"
        },
        {
            id: 'pants-1',
            name: "Slim Fit Cargo",
            price: 499,
            img: "acidic 12.jpg",
            description: "Stylish slim fit cargo pants"
        },
        {
            id: 'pants-2',
            name: "Street Joggers",
            price: 459,
            img: "acidic 13.jpg",
            description: "Comfortable street-style joggers"
        },
        {
            id: 'twopiece-1',
            name: "Ladies Set",
            price: 500,
            img: "acidic 28.jpg",
            description: "Elegant two-piece ladies set"
        },
        {
            id: 'twopiece-2',
            name: "Infinite Set",
            price: 500,
            img: "acidic 29.jpg",
            description: "Matching Infinite two-piece set"
        },
        {
            id: 'accessory-1',
            name: "Infinite Cap",
            price: 300,
            img: "acidic 31.jpg",
            description: "Classic Infinite design cap"
        },
        {
            id: 'accessory-2',
            name: "Rainbow Cap",
            price: 250,
            img: "acidic 30.jpg",
            description: "Colorful rainbow design cap"
        }
    ],


    tshirts: [
        {
            id: 'tshirt-1',
            name: "Infinite",
            price: 250,
            img: "acidic 3.jpg",
            description: "Classic Infinite design t-shirt"
        },
        {
            id: 'tshirt-2',
            name: "Infinite II",
            price: 350,
            img: "acidic 33.jpg",
            description: "Second edition Infinite t-shirt"
        },
        {
            id: 'tshirt-3',
            name: "Acidic Effect",
            price: 350,
            img: "acidic 4.jpg",
            description: "Vibrant Acidic Effect design"
        },
        {
            id: 'tshirt-4',
            name: "Lightning",
            price: 300,
            img: "acidic 19.jpg",
            description: "Striking lightning bolt design"
        },
        {
            id: 'tshirt-5',
            name: "Naruto",
            price: 400,
            img: "acidic 14.jpg",
            description: "Anime-inspired Naruto design"
        },
        {
            id: 'tshirt-6',
            name: "Hand Signature",
            price: 300,
            img: "acidic 16.jpg",
            description: "Artistic hand signature design"
        },
        {
            id: 'tshirt-7',
            name: "Hand Signature II",
            price: 300,
            img: "acidic 15.jpg",
            description: "Second edition hand signature"
        },
        {
            id: 'tshirt-8',
            name: "Feather Rainbow",
            price: 300,
            img: "acidic 26.jpg",
            description: "Colorful feather rainbow design"
        },
        {
            id: 'tshirt-9',
            name: "Angelic",
            price: 300,
            img: "acidic 1.jpg",
            description: "Ethereal angelic design"
        },
        {
            id: 'tshirt-10',
            name: "Rainbow",
            price: 350,
            img: "acidic 6.jpg",
            description: "Vibrant rainbow pattern"
        },
        {
            id: 'tshirt-11',
            name: "Butterfly Effect",
            price: 300,
            img: "acidic 9.jpg",
            description: "Beautiful butterfly design"
        }
    ],
    sweaters: [
        {
            id: 'sweater-1',
            name: "Infinite",
            price: 350,
            img: "acidic 2.jpg",
            description: "Warm Infinite design sweater"
        },
        {
            id: 'sweater-2',
            name: "Infinite II",
            price: 400,
            img: "acidic 7.jpg",
            description: "Second edition Infinite sweater"
        },
        {
            id: 'sweater-3',
            name: "Acidic Effect",
            price: 450,
            img: "acidic m.jpg",
            description: "Bold Acidic Effect sweater"
        },
        {
            id: 'sweater-4',
            name: "Angelic",
            price: 400,
            img: "acidic 1.jpg",
            description: "Heavenly angelic design sweater"
        },
        {
            id: 'sweater-5',
            name: "Rainbow",
            price: 400,
            img: "acidic 34.jpg",
            description: "Colorful rainbow sweater"
        },
        {
            id: 'sweater-6',
            name: "Butterfly Effect",
            price: 400,
            img: "acidic.jpg",
            description: "Elegant butterfly design sweater"
        }
    ],
    hoodies: [
        {
            id: 'hoodie-1',
            name: "Infinite II",
            price: 500,
            img: "acidic 8.jpg",
            description: "Comfortable Infinite II hoodie"
        },
        {
            id: 'hoodie-2',
            name: "Feather Rainbow",
            price: 450,
            img: "acidic 5.jpg",
            description: "Colorful feather rainbow hoodie"
        },
        {
            id: 'hoodie-3',
            name: "Hand Signature",
            price: 450,
            img: "acidic 24.jpg",
            description: "Artistic hand signature hoodie"
        },
        {
            id: 'hoodie-4',
            name: "Hand Signature II",
            price: 450,
            img: "acidic 23.jpg",
            description: "Second edition signature hoodie"
        },
        {
            id: 'hoodie-5',
            name: "Naruto",
            price: 550,
            img: "acidic 22.jpg",
            description: "Anime-inspired Naruto hoodie"
        },
        {
            id: 'hoodie-6',
            name: "Angelic",
            price: 450,
            img: "acidic 25.jpg",
            description: "Ethereal angelic design hoodie"
        },
        {
            id: 'hoodie-7',
            name: "Rainbow",
            price: 450,
            img: "acidic 27.jpg",
            description: "Vibrant rainbow hoodie"
        },
        {
            id: 'hoodie-8',
            name: "Lightning",
            price: 450,
            img: "acidic 21.jpg",
            description: "Striking lightning design hoodie"
        },
        {
            id: 'hoodie-9',
            name: "Infinite",
            price: 400,
            img: "acidic 32.jpg",
            description: "Classic Infinite design hoodie"
        }
    ],
    pants: [
        {
            id: 'pants-1',
            name: "Slim Fit Cargo",
            price: 499,
            img: "acidic 12.jpg",
            description: "Stylish slim fit cargo pants"
        },
        {
            id: 'pants-2',
            name: "Street Joggers",
            price: 459,
            img: "acidic 13.jpg",
            description: "Comfortable street-style joggers"
        }
    ],
    twopieces: [
        {
            id: 'twopiece-1',
            name: "Ladies Set",
            price: 500,
            img: "acidic 28.jpg",
            description: "Elegant two-piece ladies set"
        },
        {
            id: 'twopiece-2',
            name: "Infinite Set",
            price: 500,
            img: "acidic 29.jpg",
            description: "Matching Infinite two-piece set"
        }
    ],
    accessories: [
        {
            id: 'accessory-1',
            name: "Infinite Cap",
            price: 300,
            img: "acidic 31.jpg",
            description: "Classic Infinite design cap"
        },
        {
            id: 'accessory-2',
            name: "Rainbow Cap",
            price: 250,
            img: "acidic 30.jpg",
            description: "Colorful rainbow design cap"
        }
    ]
};

// Category information
const categories = {
    allproducts:{ title: "All Products", description: "All ACIDIC products"},
    tshirts: { title: "T-Shirts", description: "Premium cotton t-shirts" },
    sweaters: { title: "Sweaters", description: "Warm and stylish sweaters" },
    hoodies: { title: "Hoodies", description: "Comfortable urban hoodies" },
    pants: { title: "Pants", description: "Streetwear and casual pants" },
    twopieces: { title: "Two Pieces", description: "Matching outfit sets" },
    accessories: { title: "Accessories", description: "Complete your look" }
};

// Track added items
let cartItems = JSON.parse(localStorage.getItem('acidic-cart-items')) || {};

// Display products function
function displayProducts(category = 'all') {
    const productsGrid = document.getElementById('products-grid');
    const categoryTitle = document.getElementById('category-title');
    const categoryDescription = document.getElementById('category-description');
    const productsSection = document.getElementById('products-section');
    
    // Show products section
    productsSection.style.display = 'block';
    
    // Hide other sections
    hideAllSections();
    
    // Filter products by category
    const filteredProducts = category === 'all' 
        ? products 
        : products.filter(product => product.category === category);
    
    // Update category info
    if (category !== 'all' && categories[category]) {
        categoryTitle.textContent = categories[category].title;
        categoryDescription.textContent = categories[category].description;
    } else {
        categoryTitle.textContent = 'All Products';
        categoryDescription.textContent = 'Discover our latest collection';
    }
    
    // Clear existing products
    productsGrid.innerHTML = '';
    
    // Display products
    if (filteredProducts.length === 0) {
        productsGrid.innerHTML = '<p class="no-products">No products found in this category.</p>';
        return;
    }
    
// In the displayProducts function, replace the productCard.innerHTML
filteredProducts.forEach(product => {
    const isInCart = cartItems[product.id];
    const productCard = document.createElement('div');
    productCard.className = 'product-card';
    productCard.innerHTML = `
        <div class="product-image-container">
            <img src="${product.image}" alt="${product.name}" class="product-image">
            <button class="quick-add-cart ${isInCart ? 'added-to-cart' : ''}" 
                    onclick="event.stopPropagation(); quickAddToCart(${product.id})" 
                    title="${isInCart ? 'Added to Cart' : 'Quick Add to Cart'}">
                <svg class="cart-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.4 5.2 16.4H17M17 13V16.4M9 19C9 19.6 8.6 20 8 20C7.4 20 7 19.6 7 19C7 18.4 7.4 18 8 18C8.6 18 9 18.4 9 19ZM17 19C17 19.6 16.6 20 16 20C15.4 20 15 19.6 15 19C15 18.4 15.4 18 16 18C16.6 18 17 18.4 17 19Z" 
                          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <div class="product-info">
            <div class="product-header">
                <h3 class="product-name">${product.name}</h3>
                <div class="product-price">R${product.price}</div>
            </div>
            <div class="product-category">${product.category.toUpperCase()}</div>
            <p class="product-description">${product.description}</p>
            <div class="add-to-cart-container">
                <button class="CartBtn ${isInCart ? 'success' : ''}" 
                        onclick="addToCart(${product.id})">
                    <span class="IconContainer"> 
                        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.4 5.2 16.4H17M17 13V16.4M9 19C9 19.6 8.6 20 8 20C7.4 20 7 19.6 7 19C7 18.4 7.4 18 8 18C8.6 18 9 18.4 9 19ZM17 19C17 19.6 16.6 20 16 20C15.4 20 15 19.6 15 19C15 18.4 15.4 18 16 18C16.6 18 17 18.4 17 19Z" 
                                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    <p class="text">${isInCart ? 'Added!' : 'Add to Cart'}</p>
                </button>
            </div>
        </div>
    `;
    productsGrid.appendChild(productCard);
});
    
    // Add navigation dots if multiple products
    if (filteredProducts.length > 1) {
        addProductNavigation(filteredProducts.length);
    }
}

// Add product navigation dots
function addProductNavigation(productCount) {
    const productsGrid = document.getElementById('products-grid');
    const navContainer = document.createElement('div');
    navContainer.className = 'products-navigation';
    navContainer.id = 'products-navigation';
    
    for (let i = 0; i < productCount; i++) {
        const dot = document.createElement('div');
        dot.className = `nav-dot ${i === 0 ? 'active' : ''}`;
        dot.onclick = () => navigateToProduct(i);
        navContainer.appendChild(dot);
    }
    
    productsGrid.parentNode.insertBefore(navContainer, productsGrid.nextSibling);
}

// Navigate to specific product
function navigateToProduct(index) {
    const productsGrid = document.getElementById('products-grid');
    const productCards = productsGrid.getElementsByClassName('product-card');
    const navDots = document.querySelectorAll('.nav-dot');
    
    // Update active dot
    navDots.forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
    });
    
    // Scroll to product
    if (productCards[index]) {
        productCards[index].scrollIntoView({
            behavior: 'smooth',
            block: 'center'
        });
        
        // Add visual highlight
        productCards[index].style.boxShadow = '0 8px 30px rgba(0,0,0,0.2)';
        setTimeout(() => {
            productCards[index].style.boxShadow = '';
        }, 2000);
    }
}

// Quick add to cart function (floating icon)
function quickAddToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (product) {
        // Add bounce animation
        const button = event.target.closest('.quick-add-cart');
        button.classList.add('cart-bounce');
        
        // Remove animation class after animation completes
        setTimeout(() => {
            button.classList.remove('cart-bounce');
        }, 600);
        
        // Add to cart logic
        addToCart(productId);
        
        // Update button state
        updateCartButtonState(productId, true);
    }
}

// Enhanced add to cart function
function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (product) {
        // Add to cart items
        cartItems[productId] = true;
        localStorage.setItem('acidic-cart-items', JSON.stringify(cartItems));
        
        // Update cart count
        updateCartCount();
        
        // Show success feedback
        showCartFeedback(product.name);
        
        // Update all buttons for this product
        updateCartButtonState(productId, true);

        // Add click animation to the button
        const button = event.target.closest('.CartBtn');
        if (button) {
            button.style.transform = 'scale(0.95)';
            setTimeout(() => {
                button.style.transform = '';
            }, 150);
        }
        
        console.log(`Added ${product.name} to cart!`);
    }
}

// Update cart button state
// Update cart button state
function updateCartButtonState(productId, added) {
    // Update quick add buttons
    const quickAddButtons = document.querySelectorAll(`.quick-add-cart[onclick*="${productId}"]`);
    quickAddButtons.forEach(button => {
        if (added) {
            button.classList.add('added-to-cart');
            button.title = 'Added to Cart';
        } else {
            button.classList.remove('added-to-cart');
            button.title = 'Quick Add to Cart';
        }
    });
    
    // Update main cart buttons
    const cartButtons = document.querySelectorAll(`.CartBtn[onclick*="${productId}"]`);
    cartButtons.forEach(button => {
        if (added) {
            button.classList.add('success');
            const textElement = button.querySelector('.text');
            if (textElement) {
                textElement.textContent = 'Added!';
            }
        } else {
            button.classList.remove('success');
            const textElement = button.querySelector('.text');
            if (textElement) {
                textElement.textContent = 'Add to Cart';
            }
        }
    });
}

// Update cart count
function updateCartCount() {
    const cartCount = document.getElementById('cart-count');
    const itemCount = Object.keys(cartItems).length;
    cartCount.textContent = itemCount;
    
    // Add animation to cart icon
    cartCount.classList.add('cart-bounce');
    setTimeout(() => {
        cartCount.classList.remove('cart-bounce');
    }, 600);
}

// Show cart feedback animation
function showCartFeedback(productName) {
    // Create feedback element
    const feedback = document.createElement('div');
    feedback.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 10000;
        font-weight: 600;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        transform: translateX(100%);
        transition: transform 0.3s ease;
    `;
    feedback.textContent = `âœ“ Added ${productName} to cart!`;
    
    document.body.appendChild(feedback);
    
    // Animate in
    setTimeout(() => {
        feedback.style.transform = 'translateX(0)';
    }, 100);
    
    // Animate out and remove
    setTimeout(() => {
        feedback.style.transform = 'translateX(100%)';
        setTimeout(() => {
            document.body.removeChild(feedback);
        }, 300);
    }, 2000);
}

// Hide all sections function
function hideAllSections() {
    const sections = [
        'main-content',
        'ai-stylist-section',
        'virtual-tryon',
        'sustainability',
        'community',
        'loyalty-program',
        'outfit-builder',
        'signup-section',
        'login-section'
    ];
    
    sections.forEach(section => {
        const element = document.getElementById(section);
        if (element) element.style.display = 'none';
    });
}

// Update category navigation function
function showCategory(category) {
    // Remove active class from all nav items
    document.querySelectorAll('nav li').forEach(item => {
        item.classList.remove('active-category');
    });
    
    // Add active class to clicked item
    event.target.classList.add('active-category');
    
    // Display products for this category
    displayProducts(category);
}

// Initialize products on page load
document.addEventListener('DOMContentLoaded', function() {
    // Load cart items from localStorage
    cartItems = JSON.parse(localStorage.getItem('acidic-cart-items')) || {};
    
    // Update cart count
    updateCartCount();
    
    // Display all products initially
    displayProducts('all');
});

// Keyboard navigation
document.addEventListener('keydown', function(event) {
    const navDots = document.querySelectorAll('.nav-dot');
    if (navDots.length === 0) return;
    
    const currentActive = document.querySelector('.nav-dot.active');
    let currentIndex = Array.from(navDots).indexOf(currentActive);
    
    if (event.key === 'ArrowRight') {
        currentIndex = (currentIndex + 1) % navDots.length;
        navigateToProduct(currentIndex);
    } else if (event.key === 'ArrowLeft') {
        currentIndex = (currentIndex - 1 + navDots.length) % navDots.length;
        navigateToProduct(currentIndex);
    }
});

// === IMAGE ERROR HANDLING ===
function handleImageError(img) {
    console.log("Image failed to load:", img.src);
    img.src = "acidic 1.jpg";
    img.alt = "ACIDIC Clothing";
}

// Enhanced product display with error handling
function showCategory(category) {
    hideAllSections();
    const section = document.getElementById("product-section");
    const mainContent = document.getElementById("main-content");
    section.style.display = "grid";
    mainContent.style.display = "block";
    section.classList.remove("active");
    section.innerHTML = "";

    if (products[category]) {
        setTimeout(() => {
            products[category].forEach((item) => {
                const div = document.createElement("div");
                div.classList.add("product");
                div.innerHTML = `
                    <img src="${item.img}" alt="${item.name}" onerror="handleImageError(this)">
                    <div class="product-info">
                        <h3>${item.name}</h3>
                        <p>R${item.price}</p>
                        ${item.description ? `<p class="product-description">${item.description}</p>` : ''}
                    </div>`;
                div.onclick = () => openModal(item);
                section.appendChild(div);
            });
            requestAnimationFrame(() => section.classList.add("active"));
        }, 150);
    }
}

// Product modal functions
let currentItem = null;

function openModal(item) {
    currentItem = item;
    document.getElementById("modal-img").src = item.img;
    document.getElementById("modal-name").textContent = item.name;
    document.getElementById("modal-price").textContent = "R" + item.price;
    document.getElementById("product-modal").classList.add("active");
}

function closeModal() {
    document.getElementById("product-modal").classList.remove("active");
}

function showCustomizeModal() {
    closeModal();
    document.getElementById("customize-modal").classList.add("active");
}

function closeCustomize() {
    document.getElementById("customize-modal").classList.remove("active");
}

// Color selection with names
let selectedColor = "black";
let selectedColorName = "Black";

function selectColor(element, colorCode, colorName) {
    selectedColor = colorCode;
    selectedColorName = colorName;
    
    // Update visual selection
    document.querySelectorAll(".color-option").forEach((opt) => {
        opt.classList.remove("active");
    });
    element.classList.add("active");
    
    // Update selected color info display
    const colorInfo = document.getElementById("selected-color-info");
    if (colorInfo) {
        colorInfo.innerHTML = `Selected: <strong>${colorName}</strong>`;
    }
    
    console.log(`Color selected: ${colorName} (${colorCode})`);
}

// Size recommender
function showSizeRecommender() {
    const modal = document.getElementById("size-recommender-modal");
    modal.classList.add("active");
}

function closeSizeRecommender() {
    document.getElementById("size-recommender-modal").classList.remove("active");
}

function calculateSize() {
    const height = parseInt(document.getElementById("user-height").value);
    const weight = parseInt(document.getElementById("user-weight").value);
    const fit = document.getElementById("preferred-fit").value;

    if (!height || !weight) {
        alert("Please enter your height and weight.");
        return;
    }

    let size = "Medium"; // Default

    // Simple size calculation logic
    if (height < 165) {
        size = fit === "oversized" ? "Medium" : "Small";
    } else if (height >= 165 && height < 180) {
        if (weight < 70) {
            size = fit === "slim" ? "Small" : fit === "oversized" ? "Large" : "Medium";
        } else {
            size = fit === "slim" ? "Medium" : fit === "oversized" ? "Extra Large" : "Large";
        }
    } else {
        size = fit === "slim" ? "Large" : "Extra Large";
    }

    document.getElementById("size-result").textContent = `Recommended Size: ${size}`;
}

// Enhanced find product functions
function findProductImage(item) {
    // Use stored image if available
    if (item.image) {
        return item.image;
    }
    
    // Use product ID if available
    if (item.productId) {
        for (const category in products) {
            const product = products[category].find(p => p.id === item.productId);
            if (product) {
                return product.img;
            }
        }
    }
    
    // Fallback to name search
    for (const category in products) {
        const product = products[category].find(p => p.name === item.name);
        if (product) {
            return product.img;
        }
    }
    
    // Ultimate fallback
    return "acidic 1.jpg";
}

function findProductByName(productName) {
    for (const category in products) {
        const product = products[category].find(p => p.name === productName);
        if (product) {
            return product;
        }
    }
    return null;
}

function findProductById(productId) {
    for (const category in products) {
        const product = products[category].find(p => p.id === productId);
        if (product) {
            return product;
        }
    }
    return null;
}

// Utility function to hide all sections
function hideAllSections() {
    const sections = [
        "main-content",
        "product-section", 
        "ai-stylist-section",
        "virtual-tryon",
        "sustainability",
        "community",
        "loyalty-program",
        "outfit-builder",
        "signup-section",
        "login-section"
    ];
    
    sections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
            section.style.display = "none";
        }
    });
}

// Display products function
function displayProducts(category = 'all') {
    const productsGrid = document.getElementById('products-grid');
    const categoryTitle = document.getElementById('category-title');
    const categoryDescription = document.getElementById('category-description');
    const productsSection = document.getElementById('products-section');
    
    // Show products section
    productsSection.style.display = 'block';
    
    // Hide other sections
    hideAllSections();
    
    // Filter products by category
    const filteredProducts = category === 'all' 
        ? products 
        : products.filter(product => product.category === category);
    
    // Update category info
    if (category !== 'all' && categories[category]) {
        categoryTitle.textContent = categories[category].title;
        categoryDescription.textContent = categories[category].description;
    } else {
        categoryTitle.textContent = 'All Products';
        categoryDescription.textContent = 'Discover our latest collection';
    }
    
    // Clear existing products
    productsGrid.innerHTML = '';
    
    // Display products
    if (filteredProducts.length === 0) {
        productsGrid.innerHTML = '<p class="no-products">No products found in this category.</p>';
        return;
    }
    
    filteredProducts.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.innerHTML = `
            <div class="product-image-container">
                <img src="${product.image}" alt="${product.name}" class="product-image">
                <button class="quick-add-cart" onclick="event.stopPropagation(); quickAddToCart(${product.id})" title="Quick Add to Cart">
                    <svg class="cart-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.4 5.2 16.4H17M17 13V16.4M9 19C9 19.6 8.6 20 8 20C7.4 20 7 19.6 7 19C7 18.4 7.4 18 8 18C8.6 18 9 18.4 9 19ZM17 19C17 19.6 16.6 20 16 20C15.4 20 15 19.6 15 19C15 18.4 15.4 18 16 18C16.6 18 17 18.4 17 19Z" 
                              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="product-info">
                <div class="product-header">
                    <h3 class="product-name">${product.name}</h3>
                    <div class="product-price">R${product.price}</div>
                </div>
                <div class="product-category">${product.category.toUpperCase()}</div>
                <p class="product-description">${product.description}</p>
                <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                    <svg class="cart-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.4 5.2 16.4H17M17 13V16.4M9 19C9 19.6 8.6 20 8 20C7.4 20 7 19.6 7 19C7 18.4 7.4 18 8 18C8.6 18 9 18.4 9 19ZM17 19C17 19.6 16.6 20 16 20C15.4 20 15 19.6 15 19C15 18.4 15.4 18 16 18C16.6 18 17 18.4 17 19Z" 
                              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Add to Cart
                </button>
            </div>
        `;
        productsGrid.appendChild(productCard);
    });
}

// Quick add to cart function (floating icon)
function quickAddToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (product) {
        // Add bounce animation
        const button = event.target.closest('.quick-add-cart');
        button.classList.add('cart-bounce');
        
        // Remove animation class after animation completes
        setTimeout(() => {
            button.classList.remove('cart-bounce');
        }, 600);
        
        // Add to cart logic
        addToCart(productId);

        // Update button state
        updateCartButtonState(productId, true);
    }
}

// Enhanced add to cart function
function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (product) {
        // Update cart count
        const cartCount = document.getElementById('cart-count');
        let currentCount = parseInt(cartCount.textContent) || 0;
        cartCount.textContent = currentCount + 1;
        
        // Show success feedback
        showCartFeedback(product.name);
        
        // You can integrate this with your existing cart system
        console.log(`Added ${product.name} to cart!`);
        
        // Optional: Update your existing cart system here
        // addToCartSystem(product);
    }
}

// Show cart feedback animation
// Show cart feedback animation
function showCartFeedback(productName) {
    // Create feedback element
    const feedback = document.createElement('div');
    feedback.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: rgb(255, 208, 0);
        color: rgb(17, 17, 17);
        padding: 12px 20px;
        border-radius: 12px;
        z-index: 10000;
        font-weight: 600;
        box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.103);
        transform: translateX(100%);
        transition: transform 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    `;
    feedback.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.4 5.2 16.4H17M17 13V16.4M9 19C9 19.6 8.6 20 8 20C7.4 20 7 19.6 7 19C7 18.4 7.4 18 8 18C8.6 18 9 18.4 9 19ZM17 19C17 19.6 16.6 20 16 20C15.4 20 15 19.6 15 19C15 18.4 15.4 18 16 18C16.6 18 17 18.4 17 19Z" 
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Added ${productName} to cart!
    `;
    
    document.body.appendChild(feedback);
    
    // Animate in
    setTimeout(() => {
        feedback.style.transform = 'translateX(0)';
    }, 100);
    
    // Animate out and remove
    setTimeout(() => {
        feedback.style.transform = 'translateX(100%)';
        setTimeout(() => {
            document.body.removeChild(feedback);
        }, 300);
    }, 2000);
}

// Make products and functions available globally
window.products = products;
window.showCategory = showCategory;
window.openModal = openModal;
window.closeModal = closeModal;
window.handleImageError = handleImageError;
window.showCustomizeModal = showCustomizeModal;
window.closeCustomize = closeCustomize;
window.selectColor = selectColor;
window.showSizeRecommender = showSizeRecommender;
window.closeSizeRecommender = closeSizeRecommender;
window.calculateSize = calculateSize;
window.findProductImage = findProductImage;
window.findProductByName = findProductByName;
window.findProductById = findProductById;
window.hideAllSections = hideAllSections;

console.log("Products module loaded successfully!");

